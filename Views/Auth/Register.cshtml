@model DocketEagle.Models.RegisterViewModel

@{
    ViewData["Title"] = "Register";
}

<link rel="stylesheet" href="~/css/Register.css" asp-append-version="true" />
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <a class="navbar-brand" asp-controller="Home" asp-action="Index">
            <img src="~/DocketEagle-logo.svg.png" alt="DocketEagle Logo" style="width: 50px; height: auto;">
            DocketEagle
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" asp-controller="Home" asp-action="Index">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link btn btn-primary text-white" asp-controller="Auth" asp-action="Signin">Sign In</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<section class="form-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
                <div class="form-container">
                    <h2 class="text-center">Register for DocketEagle</h2>
                    <form asp-action="HandleRegister" asp-controller="Auth" method="post" id="registrationForm">
                        @if (!ViewData.ModelState.IsValid)
                        {
                            <div class="alert alert-danger">
                                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                                {
                                    <p>@error.ErrorMessage</p>
                                }
                            </div>
                        }

                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <input asp-for="FirstName" class="form-control" placeholder="First Name" required />
                                <span asp-validation-for="FirstName" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <input asp-for="LastName" class="form-control" placeholder="Last Name" required />
                                <span asp-validation-for="LastName" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <input asp-for="Email" class="form-control" placeholder="Email address" required />
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <input asp-for="Number" class="form-control" placeholder="Number" required />
                                <span asp-validation-for="Number" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <input asp-for="Password" class="form-control" placeholder="Password" type="password" required />
                            <span asp-validation-for="Password" class="text-danger"></span>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <select asp-for="SocialMedia" class="form-select" required>
                                    <option value="" selected disabled>Select Social Media for Updates</option>
                                    <option value="facebook">Facebook</option>
                                    <option value="twitter">Twitter</option>
                                    <option value="instagram">Instagram</option>
                                    <option value="linkedin">LinkedIn</option>
                                    <option value="Email">Email</option>
                                    <option value="Mobile">Mobile</option>
                                    <option value="SMS">SMS</option>
                                    <option value="Messenger">Messenger</option>
                                    <option value="Telegram">Telegram</option>
                                </select>
                                <span asp-validation-for="SocialMedia" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <input asp-for="SocialMediaHandle" class="form-control" placeholder="Handle" required />
                                <span asp-validation-for="SocialMediaHandle" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3 text-center">
                            <h3 class="section-heading">Billing Cycle</h3>
                            <div class="btn-group d-flex flex-wrap" role="group" aria-label="Billing Cycle">
                                <input asp-for="BillingCycle" type="radio" class="btn-check" id="monthly" value="Monthly" autocomplete="off" checked />
                                <label class="btn btn-outline-primary flex-grow-1" for="monthly">Monthly</label>
                                <input asp-for="BillingCycle" type="radio" class="btn-check" id="annual" value="Annually" autocomplete="off" />
                                <label class="btn btn-outline-primary flex-grow-1" for="annual">Annual</label>
                            </div>
                            <span asp-validation-for="BillingCycle" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <h3 class="section-heading text-center">Select Your Plan</h3>
                            <p class="mt-2 mb-3 text-center">Introductory offer for first 100 (Pioneer) Subscribers</p>
                            <div class="row" id="pricingTiers">
                                <div class="col-6 col-md-3 mb-2">
                                    <button type="button" class="btn btn-outline-primary w-100 pricing-button" data-tier="Upto2">
                                        <span class="dockets">Up to 2 dockets</span>
                                        <span class="price">$9.99</span>
                                        <span class="annual-price" style="display: none;">
                                            <span class="original-price"><s>$119.99</s></span>
                                        </span>
                                    </button>
                                </div>
                                <div class="col-6 col-md-3 mb-2">
                                    <button type="button" class="btn btn-outline-primary w-100 pricing-button" data-tier="Upto4">
                                        <span class="dockets">Up to 4 dockets</span>
                                        <span class="price">$19.98</span>
                                        <span class="annual-price" style="display: none;">
                                            <span class="original-price"><s>$239.98</s></span>

                                        </span>
                                    </button>
                                </div>
                                <div class="col-6 col-md-3 mb-2">
                                    <button type="button" class="btn btn-outline-primary w-100 pricing-button" data-tier="Upto6">
                                        <span class="dockets">Up to 6 dockets</span>
                                        <span class="price">$29.97</span>
                                        <span class="annual-price" style="display: none;">
                                            <span class="original-price"><s>$359.97</s></span>

                                        </span>
                                    </button>
                                </div>
                                <div class="col-6 col-md-3 mb-2">
                                    <button type="button" class="btn btn-outline-primary w-100 pricing-button" data-tier="Unlimited">
                                        <span class="dockets">Unlimited dockets*</span>
                                        <span class="price">$49.99</span>
                                        <span class="annual-price" style="display: none;">
                                            <span class="original-price"><s>$599.99</s></span>

                                        </span>
                                    </button>
                                </div>
                                <input asp-for="Plan" name="Plan" style="display:none;"/>
                            </div>
                            <span asp-validation-for="Plan" class="text-danger"></span>
                        </div>

                        <div id="termsAndConditions" class="text-danger text-center mt-3" style="display: none;">
                            <p>*Terms and conditions apply</p>
                        </div>

                        <div class="mb-3 mt-3">
                            <h3 class="section-heading text-center">Case Numbers & Court Details</h3>
                            <div id="caseFields">
                                @for (int i = 0; i < Model.CaseDetails.Count; i++)
                                {
                                    <div class="row mb-2">
                                        <div class="col-md-6 mb-2 mb-md-0">
                                            <input asp-for="@Model.CaseDetails[i].CaseNumber" name="CaseDetails[@i].CaseNumber" class="form-control" placeholder="Case number @(i + 1)" required />
                                            <span asp-validation-for="@Model.CaseDetails[i].CaseNumber" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <input asp-for="@Model.CaseDetails[i].CourtDetails" name="CaseDetails[@i].CourtDetails" class="form-control" placeholder="Court details @(i + 1)" required />
                                            <span asp-validation-for="@Model.CaseDetails[i].CourtDetails" class="text-danger"></span>
                                        </div>
                                    </div>
                                }
                            </div>
                            <div id="addFieldButton" class="text-center mt-2" style="display: none;">
                                <button type="button" class="btn btn-outline-primary btn-sm" id="addCaseField">+ Add Case</button>
                            </div>
                        </div>


                        <div class="mb-3 text-center">
                            <h4>Total: $<span id="totalPrice">9.99</span></h4>
                            <p class="mt-2 mb-0">Auto-renewal does not apply.</p>
                        </div>

                        <div class="mb-3 form-check">
                            <input asp-for="AgreeToTerms" type="checkbox" class="form-check-input" id="termsCheck" required />
                            <label class="form-check-label" for="termsCheck">
                                I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal" target="_blank">Terms and Conditions</a>
                            </label>
                            <span asp-validation-for="AgreeToTerms" class="text-danger"></span>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Register/Checkout</button>
                    </form>
                    <div class="text-center mt-3">
                        <p>Already have an account? <a asp-controller="Auth" asp-action="Signin" class="text-primary">Sign In</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="mt-4">
    <div class="container">
        <div class="text-center">
            <p>&copy; 2024 DocketEagle. All Rights Reserved</p>
            <p>Developed and designed by <a href="https://www.byteforth.com" target="_blank">ByteForth</a></p>
        </div>
    </div>
</footer>
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">Terms of Service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Here is the terms of service content...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const billingCycleRadios = document.querySelectorAll('input[name="BillingCycle"]');
        const pricingTiers = document.getElementById('pricingTiers');
        const totalPrice = document.getElementById('totalPrice');
        const termsAndConditions = document.getElementById('termsAndConditions');
        const caseFields = document.getElementById('caseFields');
        const addFieldButton = document.getElementById('addFieldButton');
        const addCaseFieldButton = document.getElementById('addCaseField');

        let caseIndex = 0;

        // Prices for both monthly and annual plans
        const prices = {
            monthly: { Upto2: 9.99, Upto4: 19.98, Upto6: 29.97, Unlimited: 49.99 },
            annual: { Upto2: 99.99, Upto4: 199.98, Upto6: 299.97, Unlimited: 499.99 }
        };

        // Updates the displayed prices based on the selected billing cycle and plan
        function updatePrices() {

            const cycle = document.querySelector('input[name="BillingCycle"]:checked').id;
            pricingTiers.querySelectorAll('button').forEach(button => {
                const tier = button.dataset.tier;
                const docketText = tier === 'Unlimited' ? 'Unlimited dockets*' : `Up to ${tier.replace('Upto', '')} dockets`;
                const priceText = `$${prices[cycle][tier].toFixed(2)}`;

                button.querySelector('.dockets').textContent = docketText;
                button.querySelector('.price').textContent = priceText;

                const annualPriceElement = button.querySelector('.annual-price');
                if (cycle === 'annual') {
                    annualPriceElement.style.display = 'block';
                } else {
                    annualPriceElement.style.display = 'none';
                }
            });
            updateTotal();
        }

        // Calculate and display the total price based on the selected plan and billing cycle
        function updateTotal() {
            const cycle = document.querySelector('input[name="BillingCycle"]:checked').id;
            const selectedTier = pricingTiers.querySelector('button.active');
            if (selectedTier) {
                const tier = selectedTier.dataset.tier;
                totalPrice.textContent = prices[cycle][tier].toFixed(2);
            }
        }

        // Handle billing cycle changes (monthly or annual)
        billingCycleRadios.forEach(radio => {
            radio.addEventListener('change', updatePrices);
        });

        // Handle plan selection and update price accordingly
        pricingTiers.addEventListener('click', function (e) {
            const targetButton = e.target.closest('button');
            const planField = document.querySelector('input[name="Plan"]');
            if (targetButton) {
                pricingTiers.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                targetButton.classList.add('active');
                const selectedTier = targetButton.dataset.tier;
                planField.value = selectedTier;
                // Show terms only for the "unlimited" plan
                if (selectedTier === 'Unlimited') {
                    termsAndConditions.style.display = 'block';
                } else {
                    termsAndConditions.style.display = 'none';
                }

                updateCaseFields(selectedTier);
                updateTotal();
            }
        });

        // Dynamically update the number of case fields based on the selected plan
        function updateCaseFields(tier) {
            caseFields.innerHTML = ''; // Clear existing case fields
            caseIndex = 0; // Reset index
            const fieldCount = tier === 'Unlimited' ? 2 : parseInt(tier.replace('Upto', ''));
            for (let i = 1; i <= fieldCount; i++) {
                addCaseField();
            }

            // Show the "Add Case" button only for the unlimited plan
            if (tier === 'Unlimited') {
                addFieldButton.style.display = 'block';
            } else {
                addFieldButton.style.display = 'none';
            }
        }

        // Function to dynamically add a case field to the form
        function addCaseField() {
            const row = document.createElement('div');
            row.className = 'row mb-2';

            const caseNumberCol = document.createElement('div');
            caseNumberCol.className = 'col-md-6 mb-2 mb-md-0';
            const caseNumberInput = document.createElement('input');
            caseNumberInput.type = 'text';
            caseNumberInput.className = 'form-control';
            caseNumberInput.name = `CaseDetails[${caseIndex}].CaseNumber`;
            caseNumberInput.placeholder = `Case number ${caseIndex + 1}`;
            caseNumberInput.required = true;
            caseNumberCol.appendChild(caseNumberInput);

            const courtDetailsCol = document.createElement('div');
            courtDetailsCol.className = 'col-md-6';
            const courtDetailsInput = document.createElement('input');
            courtDetailsInput.type = 'text';
            courtDetailsInput.className = 'form-control';
            courtDetailsInput.name = `CaseDetails[${caseIndex}].CourtDetails`;
            courtDetailsInput.placeholder = `Court details ${caseIndex + 1}`;
            courtDetailsInput.required = true;
            courtDetailsCol.appendChild(courtDetailsInput);

            row.appendChild(caseNumberCol);
            row.appendChild(courtDetailsCol);
            caseFields.appendChild(row);

            caseIndex++; // Increment the case index for the next field
        }

        // Add more case fields when the "Add Case" button is clicked (for unlimited plan)
        addCaseFieldButton.addEventListener('click', () => addCaseField());

        // Initialize with 2 case fields for the default "Up to 2" plan
        pricingTiers.querySelector('button[data-tier="Upto2"]').classList.add('active');
        updateCaseFields('Upto2'); // Set 2 fields initially
        updatePrices(); // Initialize prices

        // Form submission handler (for demo purposes)
        // document.getElementById('registrationForm').addEventListener('submit', function (e) {
        //     e.preventDefault(); // Prevent actual form submission (demo)
        //     alert('Form submitted successfully!');
        // });
    });
</script>
